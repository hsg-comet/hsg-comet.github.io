<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>기사 작성</title>
  <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f9f9f9;
      margin: 0;
      padding: 0;
    }
    .container {
      width: 80%;
      margin: 50px auto;
      background-color: white;
      padding: 20px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }
    input[type="text"] {
      width: 100%;
      padding: 10px;
      margin-bottom: 20px;
      border: 1px solid #ddd;
      border-radius: 4px;
    }
    #editor {
      height: 300px;
    }
    button {
      padding: 10px 20px;
      background-color: #28a745;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    button:hover {
      background-color: #218838;
    }
    .article-list {
      margin-top: 50px;
    }
    .article-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin: 10px 0;
    }
    .login-container {
      text-align: center;
      margin-bottom: 20px;
    }
  </style>
</head>
<body>

<div class="container">
  <h2>기사 작성</h2>
  <div class="login-container">
    <div id="g_id_onload"
         data-client_id="931616178821-8gjrtu3isc3h18kqnq7b0i2p7dqdssc9.apps.googleusercontent.com"
         data-callback="handleCredentialResponse">
    </div>
    <div class="g_id_signin" data-type="standard"></div>
  </div>
  <input type="text" id="title" placeholder="기사 제목을 입력하세요" required>
  
  <div id="editor">
    <p>기사 내용을 여기에 작성하세요...</p>
  </div>

  <button id="submitBtn">기사 저장</button>

  <div class="article-list">
    <h3>저장된 기사 목록</h3>
    <ul id="articleList"></ul>
  </div>
</div>

<!-- Quill.js 라이브러리 로드 -->
<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
<script src="https://accounts.google.com/gsi/client" async defer></script>

<script>
  var quill = new Quill('#editor', {
    theme: 'snow',
    placeholder: '기사 내용을 입력하세요...',
    modules: {
      toolbar: [
        [{ 'header': [1, 2, false] }],
        ['bold', 'italic', 'underline'],
        ['link', 'image'],
        [{ 'list': 'ordered'}, { 'list': 'bullet' }]
      ]
    }
  });

  let currentEditIndex = null; // 현재 수정 중인 기사 인덱스

  function loadArticles() {
    const savedArticles = JSON.parse(localStorage.getItem('articles')) || [];
    const articleList = document.getElementById('articleList');
    articleList.innerHTML = '';
    savedArticles.forEach((article, index) => {
      const listItem = document.createElement('li');
      listItem.className = 'article-item';
      listItem.innerHTML = `
        <span>${index + 1}. ${article.title}</span>
        <div>
          <button onclick="editArticle(${index})">수정</button>
          <button onclick="deleteArticle(${index})">삭제</button>
        </div>
      `;
      articleList.appendChild(listItem);
    });
  }

  document.getElementById('submitBtn').addEventListener('click', function() {
    var title = document.getElementById('title').value;
    var content = quill.root.innerHTML;

    if (title && content) {
      const savedArticles = JSON.parse(localStorage.getItem('articles')) || [];
      if (currentEditIndex !== null) {
        // 수정 모드
        savedArticles[currentEditIndex] = { title: title, content: content };
        alert('기사가 수정되었습니다.');
        currentEditIndex = null; // 수정 후 인덱스 초기화
      } else {
        // 저장 모드
        savedArticles.push({ title: title, content: content });
        alert('기사가 저장되었습니다.');
      }
      localStorage.setItem('articles', JSON.stringify(savedArticles));
      loadArticles();
      document.getElementById('title').value = '';
      quill.root.innerHTML = '<p><br></p>';
    } else {
      alert('제목과 내용을 입력하세요!');
    }
  });

  function editArticle(index) {
    const savedArticles = JSON.parse(localStorage.getItem('articles'));
    document.getElementById('title').value = savedArticles[index].title;
    quill.root.innerHTML = savedArticles[index].content;
    currentEditIndex = index; // 현재 수정 중인 인덱스 설정
  }

  function deleteArticle(index) {
    const savedArticles = JSON.parse(localStorage.getItem('articles'));
    savedArticles.splice(index, 1); // 선택한 기사 삭제
    localStorage.setItem('articles', JSON.stringify(savedArticles));
    alert('기사가 삭제되었습니다.');
    loadArticles();
  }

  window.onload = function() {
    loadArticles();
  };

  function handleCredentialResponse(response) {
    const token = response.credential;
    // 사용자 인증이 완료된 후 이곳에서 추가 로직을 작성할 수 있습니다.
    console.log('토큰:', token);
    // 사용자 정보 요청
    fetch(`https://www.googleapis.com/oauth2/v3/userinfo?access_token=${token}`)
      .then(response => response.json())
      .then(data => {
        console.log('사용자 정보:', data);
        alert(`안녕하세요, ${data.name}님!`);
      });
  }
</script>

</body>
</html>
